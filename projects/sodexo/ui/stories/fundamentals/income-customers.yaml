---
id: f60c9a14-8069-4ff1-ab51-aad9af6c5409
name: '收入及客流'

data:
  resturants:
    - 汇总
    - 员工餐厅
    - 粤菜餐厅
    - 北京小院
    - 咖啡厅
    - 咖喱屋
    - 自助餐厅
    - 西餐厅
    - 意大利餐厅
  selectedResturants:
    - 汇总

  mealTimes:
    - 汇总
    - 早餐
    - 午餐
    - 晚餐
  selectedMealTimes:
    - 汇总

  cardTypes:
    - 汇总
    - 员工卡
    - 访客卡
  selectedCardTypes:
    - 汇总

  granularities:
    - 按天
    - 按周
    - 按月
  selectedGranularity: 按天

  selectedDateRange:
    start: '2018-01-13'
    end: '2018-04-13'

  a: 1
  b: 2
  ui_a:
    value:
      $ref: a
  ui_b:
    value:
      $ref: b
  sum:
    $proc: 'sum'
    $args:
      - $ref: a
      - $ref: b
  ui_sum:
    value:
      $ref: sum
  ui_resturants:
    enums:
      $ref: resturants
    defaultValue:
      $ref: selectedResturants
    label: 餐厅
  ui_mealTimes:
    enums:
      $ref: mealTimes
    defaultValue:
      $ref: selectedMealTimes
    label: 用餐时段
  ui_cardTypes:
    enums:
      $ref: cardTypes
    defaultValue:
      $ref: selectedCardTypes
    label: 卡类型
  ui_granularities:
    enums:
      $ref: granularities
    defaultValue:
      $ref: selectedGranularity
    label: 粒度

  revenueTrend:
    $proc: slice
    $args:
      Collapse:
        - BranchName
        - MealName
        - CardType
      StartTime: '2014-4-14T00:00:00Z'
      EndTime: '2018-4-13T00:00:00Z'
      Filter:
        $proc: queryFilter
        $args:
          BranchName:
            $ref: selectedResturants
          MealName:
            $ref: selectedMealTimes
          CardType:
            $ref: selectedCardTypes
      Granularity: Monthly
      Metrics: Revenue
  
  customerTrend:
    $proc: slice
    $args:
      Collapse:
        - BranchName
        - MealName
        - CardType
      StartTime: '2014-4-14T00:00:00Z'
      EndTime: '2018-4-13T00:00:00Z'
      Filter:
        $proc: queryFilter
        $args:
          BranchName:
            $ref: selectedResturants
          MealName:
            $ref: selectedMealTimes
          CardType:
            $ref: selectedCardTypes
      Granularity: Daily
      Metrics: UserCount
  
  incomePercentageByResturant:
    $proc: ranker
    $args:
      Dimensions:
        - BranchName
      StartTime: '2018-1-13T00:00:00Z'
      EndTime: '2018-4-13T00:00:00Z'
      Metrics: Revenue
      OrderBy: DESC
      ValueLimit: 10
  
  incomePercentageByMeal:
    $proc: ranker
    $args:
      Dimensions:
        - MealName
      StartTime: '2018-1-13T00:00:00Z'
      EndTime: '2018-4-13T00:00:00Z'
      Metrics: Revenue
      OrderBy: DESC
      ValueLimit: 10
  
  incomePercentageByCard:
    $proc: ranker
    $args:
      Dimensions:
        - CardType
      StartTime: '2018-1-13T00:00:00Z'
      EndTime: '2018-4-13T00:00:00Z'
      Metrics: Revenue
      OrderBy: DESC
      ValueLimit: 10

  customerPercentageByResturant:
    $proc: ranker
    $args:
      Dimensions:
        - BranchName
      StartTime: '2018-1-13T00:00:00Z'
      EndTime: '2018-4-13T00:00:00Z'
      Metrics: UserCount
      OrderBy: DESC
      ValueLimit: 10
  
  customerPercentageByMeal:
    $proc: ranker
    $args:
      Dimensions:
        - MealName
      StartTime: '2018-1-13T00:00:00Z'
      EndTime: '2018-4-13T00:00:00Z'
      Metrics: UserCount
      OrderBy: DESC
      ValueLimit: 10

  customerPercentageByCard:
    $proc: ranker
    $args:
      Dimensions:
        - CardType
      StartTime: '2018-1-13T00:00:00Z'
      EndTime: '2018-4-13T00:00:00Z'
      Metrics: UserCount
      OrderBy: DESC
      ValueLimit: 10



layout:
  id: 90b2ff58-c292-48ff-8b8e-703b50a900e4
  type: FlexboxContainer
  props:
    direction: 'vertical'
    align: 'center'
    items:
      # - id: 437b4f68-7505-4749-9663-63d39ec03cf3
      #   type: CardContainer
      #   props:
      #     width: 500px
      #     height: 500px
      #     items:
      #       - id: ddbd6cbe-0f7b-43d6-a1b3-6ffdc3dda101
      #         type: FormInput
      #         output: a
      #         input: ui_a
      #         width: 200px
      # - id: 223a6d8c-7ee7-4dd6-9aea-62e7175c4b7c
      #   type: FormInput
      #   output: b
      #   input: ui_b
      #   props:
      #     width: 200px
      # - id: a8c5e778-87d1-4c81-8ecf-821a15d16e4c
      #   type: FormInput
      #   input: ui_sum
      #   props:
      #     width: 300px
      - id: cacaaa77-0878-4dee-851f-f9d13e2c6ac6
        type: MultiSelector
        input: ui_resturants
        output: selectedResturants
      - id: a36419d4-3931-4f72-a2cb-dbd3e611902c
        type: MultiSelector
        input: ui_mealTimes
        output: selectedMealTimes
      - id: b0ab148c-1eb2-48a0-8415-f5f22532ebed
        type: MultiSelector
        input: ui_cardTypes
        output: selectedCardTypes
      - id: 426a72ad-6176-4d56-a3f7-10ff1c3a692e
        type: SingleSelector
        input: ui_granularities
        output: selectedGranularity
      - id: ed557de6-017a-4a87-bf87-a2ea6e34ea6e
        type: TimeRange
        input: selectedDateRange
        output: selectedDateRange
        props:
          label: 时间
      - id: 4307046e-f941-444f-a2fe-562a80ae4734
        type: Trend
        input: revenueTrend
        props:
          title: 收入趋势
      - id: 2f93fe88-1bac-45ab-b710-930449a2379e
        type: Percentage
        input: incomePercentageByResturant
        props:
          title: 各餐厅收入比例
      - id: d38e22bf-ef06-46b0-869f-d89b518df0f9
        type: Percentage
        input: incomePercentageByMeal
        props:
          title: 各用餐时段收入比例
      - id: 481276bf-d8a7-4063-914a-e70e83afaad6
        type: Percentage
        input: incomePercentageByCard
        props:
          title: 各卡种收入比例
      - id: 62587c53-7ee8-4e6e-adae-5115ea36307b
        type: Trend
        input: customerTrend
        props:
          title: 用餐人数趋势
      - id: 0a394c47-431c-4be3-81fe-ff0e4f27a548
        type: Percentage
        input: customerPercentageByResturant
        props:
          title: 各餐厅客流比例
      - id: b593de2d-e460-4295-ac28-0727e9088656
        type: Percentage
        input: customerPercentageByMeal
        props:
          title: 各用餐时段客流比例
      - id: caa308af-f50c-4fa4-b0d8-cf83aa030f12
        type: Percentage
        input: customerPercentageByCard
        props:
          title: 各卡种客流比例
