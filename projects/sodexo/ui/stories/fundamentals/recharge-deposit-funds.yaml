---
id: b47efc62-da23-49d6-ab9c-2a734d53299a
name: 充值及沉淀资金

# Data flow diagram
data:
  # parameters
  p_card_type:
    - 员工卡
  p_granularity: Monthly
  p_time:
    start: '2014-4-13'
    end: '2018-4-14'

  # ui nodes
  ui_time_range:
    start: '2014-4-13'
    end: '2018-4-14'
  ui_card_selector:
    enums:
      $proc: getEnum
      $args: CardType
    defaultValue:
      - 员工卡
    label: 卡类型
  ui_granularity_selector:
    enums:
      $proc: getEnumSelectorProps
      $args: Granularity
    defaultValue: Monthly
    label: 粒度
  ui_recharge_trend:
    $proc: slice
    $args:
      $proc: sliceQuery
      $args:
        time:
          $ref: p_time
        CardType:
          $ref: p_card_type
        ChargeType:
          - 充值
        Collapse:
          - CardType
          - ChargeType
        Granularity:
          $ref: p_granularity
        Metrics: ChargeAmount
  ui_recharge_trend_ChartProps:
    source:
      $ref: ui_recharge_trend
  ui_average_charge_trend:
    $proc: slice
    $args:
      $proc: sliceQuery
      $args:
        time:
          $ref: p_time
        CardType:
          $ref: p_card_type
        ChargeType:
          - 充值
        Collapse:
          - CardType
          - ChargeType
        Granularity:
          $ref: p_granularity
        Metrics: AvgChargeAmount
  ui_average_charge_trend_ChartProps:
    source:
      $ref: ui_average_charge_trend
  ui_charge_count:
    $proc: slice
    $args:
      $proc: sliceQuery
      $args:
        time:
          $ref: p_time
        CardType:
          $ref: p_card_type
        ChargeType:
          - 充值
        Collapse:
          - CardType
          - ChargeType
        Granularity:
          $ref: p_granularity
        Metrics: ChargeCount
  ui_charge_count_ChartProps:
    source:
      $ref: ui_charge_count
  ui_deposit_trend:
    $proc: slice
    $args:
      $proc: sliceQuery
      $args:
        time:
          $ref: p_time
        CardType:
          $ref: p_card_type
        Collapse:
          - CardType
        Granularity:
          $ref: p_granularity
        Metrics: Deposit
  ui_deposit_trend_ChartProps:
    source:
      $ref: ui_deposit_trend
  ui_deposit_total_trend:
    $proc: slice
    $args:
      $proc: sliceQuery
      $args:
        time:
          $ref: p_time
        CardType:
          $ref: p_card_type
        Collapse:
          - CardType
        Granularity:
          $ref: p_granularity
        Metrics: DepositTotal
  ui_deposit_total_trend_ChartProps:
    source:
      $ref: ui_deposit_total_trend
# Dashboard Layout
layout:
  id: 836bf8e9-ae20-42fa-9e08-8541f26db6f6
  type: FlexboxContainer
  props:
    direction: 'vertical'
    align: 'center'
    items:
      - id: dbca7612-1847-4262-82c8-9db7a0e30004
        type: MultiSelector
        input: ui_card_selector
        output: p_card_type
      - id: b48b7573-b3e7-4bfe-871f-1d7df3ec83c7
        type: SingleSelector
        input: ui_granularity_selector
        output: p_granularity
      - id: f636790b-2b10-4887-9140-d7e30f52ba58
        type: TimeRange
        input: ui_time_range
        output: p_time
        props:
          label: 时间
      - id: 16166826-753e-4f7d-94ac-6864f51165a5
        type: Trend
        input: ui_recharge_trend_ChartProps
        props:
          title: 充值收入趋势
      - id: 7c376695-9abf-430d-8cf4-11ff1f3e0383
        type: Trend
        input: ui_average_charge_trend_ChartProps
        props:
          title: 每用户平均充值变化
      # - id: d3458857-8ab9-40b2-8de0-63f5437a13b8
      #   type: Trend
      #   input: ui_charge_count_ChartProps
      #   props:
      #     title: 充值次数变化
      - id: df96303d-385b-4531-80ca-cb87377816fb
        type: Trend
        input: ui_deposit_trend_ChartProps
        props:
          title: 月沉淀资金变化
      - id: fbe769c1-7691-43b8-add9-dcca6c8b1a8e
        type: Trend
        input: ui_deposit_total_trend_ChartProps
        props:
          title: 沉淀资金累计


